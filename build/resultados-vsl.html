<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seu Diagn√≥stico Est√° Pronto - Quiz MTC</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f9fafb;
      line-height: 1.6;
      color: #1f2937;
    }

    /* VSL Container - Single Column Flow */
    .vsl-container {
      max-width: 720px;
      margin: 0 auto;
      padding: 0;
    }

    /* Sections with Clear Visual Hierarchy */
    .section {
      background: white;
      margin-bottom: 2px;
      padding: 48px 32px;
    }

    .section-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      padding: 60px 32px;
    }

    .section-problem {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
    }

    .section-agitation {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
    }

    .section-solution {
      background: #d1fae5;
      border-left: 4px solid #10b981;
    }

    .section-cta {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      text-align: center;
      padding: 60px 32px;
    }

    /* Typography */
    h1 {
      font-size: 36px;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 16px;
    }

    h2 {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 20px;
      color: #111827;
    }

    h3 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #374151;
    }

    p {
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 16px;
      color: #4b5563;
    }

    .lead-text {
      font-size: 20px;
      font-weight: 500;
      line-height: 1.6;
    }

    .subtitle {
      font-size: 18px;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Score Display */
    .score-hero {
      display: inline-block;
      background: white;
      color: #667eea;
      font-size: 72px;
      font-weight: 900;
      padding: 20px 40px;
      border-radius: 16px;
      margin: 24px 0;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    .element-badge-large {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 24px;
      font-weight: 600;
      margin-top: 16px;
    }

    /* Mini Scores Grid */
    .mini-scores {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin: 32px 0;
    }

    .mini-score-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .mini-score-value {
      font-size: 32px;
      font-weight: 700;
      color: #667eea;
      display: block;
      margin-bottom: 4px;
    }

    .mini-score-label {
      font-size: 14px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Problem/Agitation Lists */
    .symptom-list {
      list-style: none;
      margin: 24px 0;
    }

    .symptom-list li {
      padding: 12px 0;
      font-size: 18px;
      line-height: 1.6;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .symptom-list li:last-child {
      border-bottom: none;
    }

    .symptom-list li::before {
      content: "‚ö†Ô∏è ";
      margin-right: 8px;
    }

    /* Diagnosis Box */
    .diagnosis-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
      border: 2px solid #f59e0b;
      border-radius: 12px;
      padding: 32px;
      margin: 32px 0;
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2);
    }

    .diagnosis-box h3 {
      color: #92400e;
      margin-bottom: 20px;
    }

    .diagnosis-box p {
      color: #78350f;
      white-space: pre-line;
    }

    /* CTA Button */
    .cta-button {
      display: inline-block;
      background: white;
      color: #f5576c;
      font-size: 24px;
      font-weight: 700;
      padding: 20px 48px;
      border-radius: 50px;
      text-decoration: none;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      margin-top: 24px;
      cursor: pointer;
      border: none;
    }

    .cta-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 14px 50px rgba(0,0,0,0.4);
    }

    .cta-secondary {
      background: rgba(255,255,255,0.2);
      color: white;
      backdrop-filter: blur(10px);
      font-size: 18px;
      padding: 14px 32px;
      margin-top: 16px;
    }

    /* Urgency Timer */
    .urgency-box {
      background: #fef3c7;
      border: 2px dashed #f59e0b;
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
      text-align: center;
    }

    .urgency-box strong {
      color: #dc2626;
      font-size: 20px;
    }

    /* Social Proof */
    .social-proof {
      background: #f3f4f6;
      border-radius: 12px;
      padding: 24px;
      margin: 32px 0;
      font-style: italic;
    }

    .social-proof::before {
      content: '"';
      font-size: 48px;
      color: #667eea;
      line-height: 0;
    }

    /* Charts - Simplified */
    .chart-container {
      margin: 32px 0;
      padding: 24px;
      background: #f9fafb;
      border-radius: 12px;
    }

    .chart-container canvas {
      max-width: 100%;
      height: auto !important;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 100px 20px;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      margin: 0 auto 20px;
      border: 5px solid #f3f4f6;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 { font-size: 28px; }
      h2 { font-size: 24px; }
      .score-hero { font-size: 56px; padding: 16px 32px; }
      .section { padding: 32px 20px; }
      .section-hero, .section-cta { padding: 48px 20px; }
      .mini-scores { grid-template-columns: 1fr; }
    }

    /* Highlight Box */
    .highlight-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 32px;
      border-radius: 12px;
      margin: 32px 0;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }

    .highlight-box h3 {
      color: white;
    }

    .highlight-box p {
      color: rgba(255,255,255,0.95);
    }

    /* Benefit List */
    .benefit-list {
      list-style: none;
      margin: 24px 0;
    }

    .benefit-list li {
      padding: 12px 0;
      font-size: 18px;
      line-height: 1.7;
    }

    .benefit-list li::before {
      content: "‚úÖ ";
      margin-right: 8px;
    }

    /* Scarcity Badge */
    .scarcity-badge {
      display: inline-block;
      background: #dc2626;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body>
  <div id="loading" class="loading">
    <div class="loading-spinner"></div>
    <div>Carregando seu diagn√≥stico personalizado...</div>
  </div>

  <div id="content" class="vsl-container" style="display: none;">
    <!-- Content will be inserted here by JavaScript -->
  </div>

  <script>
    const API_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:3001'
      : 'https://quiz-mtc.vercel.app';

    const ELEMENTO_EMOJIS = {
      'RIM': 'üåä',
      'FIGADO': 'üå≥',
      'F√çGADO': 'üå≥',
      'BACO': 'üåç',
      'BA√áO': 'üåç',
      'CORACAO': 'üî•',
      'CORA√á√ÉO': 'üî•',
      'PULMAO': 'üí®',
      'PULM√ÉO': 'üí®'
    };

    const ELEMENTO_NAMES = {
      'RIM': 'Elemento √ÅGUA (Rim)',
      'FIGADO': 'Elemento MADEIRA (F√≠gado)',
      'F√çGADO': 'Elemento MADEIRA (F√≠gado)',
      'BACO': 'Elemento TERRA (Ba√ßo)',
      'BA√áO': 'Elemento TERRA (Ba√ßo)',
      'CORACAO': 'Elemento FOGO (Cora√ß√£o)',
      'CORA√á√ÉO': 'Elemento FOGO (Cora√ß√£o)',
      'PULMAO': 'Elemento METAL (Pulm√£o)',
      'PULM√ÉO': 'Elemento METAL (Pulm√£o)'
    };

    async function carregarResultados() {
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email');
      const leadId = urlParams.get('id');

      if (!email && !leadId) {
        document.getElementById('loading').innerHTML = '<p style="color: #dc2626;">‚ùå Nenhum email ou ID fornecido.</p>';
        return;
      }

      try {
        let url = `${API_URL}/api/lead/find?`;
        if (email) url += `email=${encodeURIComponent(email)}`;
        if (leadId) url += `leadId=${leadId}`;

        const response = await fetch(url);
        const data = await response.json();

        if (!data.success) {
          document.getElementById('loading').innerHTML = `<p style="color: #dc2626;">‚ùå ${data.error || 'Lead n√£o encontrado'}</p>`;
          return;
        }

        renderizarVSL(data.lead);
      } catch (error) {
        console.error('Erro:', error);
        document.getElementById('loading').innerHTML = '<p style="color: #dc2626;">‚ùå Erro ao carregar resultados.</p>';
      }
    }

    function renderizarVSL(lead) {
      const primeiroNome = lead.nome.split(' ')[0];
      const elemento = lead.elemento_principal || 'RIM';
      const emoji = ELEMENTO_EMOJIS[elemento.toUpperCase()] || 'üßò';
      const elementoNome = ELEMENTO_NAMES[elemento.toUpperCase()] || elemento;

      // Calcular scores
      const intensidadeScore = lead.intensidade_calculada
        ? Math.round((lead.intensidade_calculada / 5) * 100)
        : 0;
      const urgenciaScore = lead.urgencia_calculada
        ? Math.round((lead.urgencia_calculada / 5) * 100)
        : 0;
      const prontidaoScore = Math.round((intensidadeScore + urgenciaScore) / 2);

      const contagemElementos = lead.contagem_elementos || {};
      const valoresElementos = Object.values(contagemElementos);
      const totalElementos = valoresElementos.length > 0 ? valoresElementos.reduce((a, b) => a + b, 0) : 0;
      const elementoMax = valoresElementos.length > 0 ? Math.max(...valoresElementos) : 0;
      const equilibrioScore = totalElementos > 0 ? Math.round((1 - (elementoMax / totalElementos)) * 100) : 50;

      const diagnostico = (lead.diagnostico_completo || lead.script_abertura || '')
        .replace(/{NOME}/g, primeiroNome);

      // ESTRUTURA VSL: HOOK ‚Üí PROBLEM ‚Üí AGITATE ‚Üí SOLUTION ‚Üí CTA

      const html = `
        <!-- 1. HERO/HOOK: Capturar Aten√ß√£o Imediata -->
        <div class="section section-hero">
          <div class="scarcity-badge">‚è∞ DIAGN√ìSTICO PERSONALIZADO GERADO</div>
          <h1>${primeiroNome}, Seus Resultados Est√£o Prontos!</h1>
          <p class="subtitle">Baseado nas suas respostas, identificamos exatamente o que est√° acontecendo com sua sa√∫de...</p>

          <div class="score-hero">${lead.lead_score || prontidaoScore}</div>
          <p style="color: rgba(255,255,255,0.9); font-size: 16px; margin-top: -12px;">Seu Score de Prontid√£o para Transforma√ß√£o</p>

          <div class="element-badge-large">
            <span style="font-size: 32px;">${emoji}</span>
            <span>${elementoNome}</span>
          </div>
        </div>

        <!-- 2. PROBLEM: Identificar o Problema com Dados Reais -->
        <div class="section section-problem">
          <h2>‚ùó Aqui est√° o que descobrimos sobre voc√™, ${primeiroNome}...</h2>

          <p class="lead-text">Baseado no seu diagn√≥stico personalizado de Medicina Tradicional Chinesa, identificamos que seu <strong>${elementoNome}</strong> est√° em desequil√≠brio.</p>

          <div class="mini-scores">
            <div class="mini-score-card">
              <span class="mini-score-value">${intensidadeScore}%</span>
              <span class="mini-score-label">Intensidade dos Sintomas</span>
            </div>
            <div class="mini-score-card">
              <span class="mini-score-value">${urgenciaScore}%</span>
              <span class="mini-score-label">Urg√™ncia de Tratamento</span>
            </div>
          </div>

          <p>E aqui est√° a verdade que voc√™ precisa ouvir:</p>

          <p><strong>Esses n√∫meros n√£o mentem.</strong> Eles revelam exatamente o n√≠vel de aten√ß√£o que sua sa√∫de est√° pedindo AGORA.</p>
        </div>

        <!-- 3. AGITATION: Amplificar a Dor e o Custo de N√£o Agir -->
        <div class="section section-agitation">
          <h2>‚ö†Ô∏è O que acontece se voc√™ ignorar isso?</h2>

          <p>Veja bem, ${primeiroNome}...</p>

          <p>Voc√™ j√° sabe que algo n√£o est√° certo. Voc√™ sentiu isso quando respondeu ao question√°rio. Os sintomas que voc√™ mencionou n√£o apareceram da noite para o dia.</p>

          <p><strong>Eles s√£o sinais do seu corpo GRITANDO por ajuda.</strong></p>

          <div class="symptom-list">
            <li>A tens√£o que voc√™ sente n√£o vai desaparecer sozinha</li>
            <li>A fadiga que te acompanha todos os dias s√≥ vai piorar</li>
            <li>Os sintomas emocionais v√£o come√ßar a afetar seus relacionamentos</li>
            <li>O desequil√≠brio no seu ${elementoNome} pode desencadear problemas mais s√©rios</li>
          </div>

          ${lead.custo_mensal_problema ? `
          <div class="urgency-box">
            <p style="margin: 0; color: #92400e;"><strong>üí∏ Voc√™ est√° gastando R$ ${lead.custo_mensal_problema}/m√™s</strong> em solu√ß√µes paliativas que n√£o resolvem a raiz do problema.</p>
            <p style="margin-top: 12px; margin-bottom: 0; font-size: 16px; color: #78350f;">Isso √© <strong>R$ ${lead.custo_mensal_problema * 12}/ano</strong> jogados fora sem resultados duradouros.</p>
          </div>
          ` : ''}

          <p style="font-size: 20px; font-weight: 600; color: #dc2626;">A pergunta √©: Quanto tempo mais voc√™ vai esperar antes de fazer algo REAL sobre isso?</p>
        </div>

        <!-- 4. SOLUTION: Apresentar a Solu√ß√£o com Diagn√≥stico Personalizado -->
        <div class="section section-solution">
          <h2>‚úÖ Mas tem uma boa not√≠cia, ${primeiroNome}...</h2>

          <p class="lead-text">Voc√™ acabou de dar o passo mais importante: <strong>RECONHECER que precisa de mudan√ßa.</strong></p>

          <p>E n√£o s√≥ isso - voc√™ tem em m√£os um diagn√≥stico preciso baseado em 5.000 anos de Medicina Tradicional Chinesa.</p>

          <div class="diagnosis-box">
            <h3>üìã Seu Diagn√≥stico Personalizado:</h3>
            <p>${diagnostico}</p>
          </div>

          <p>Agora voc√™ sabe <em>exatamente</em> o que est√° acontecendo. Mas conhecimento sem a√ß√£o √© apenas informa√ß√£o...</p>

          <div class="highlight-box">
            <h3>üéØ O Que Voc√™ Pode Alcan√ßar com o Tratamento Correto:</h3>
            <ul class="benefit-list">
              <li>Eliminar os sintomas f√≠sicos que te incomodam diariamente</li>
              <li>Recuperar sua energia e vitalidade naturais</li>
              <li>Restaurar o equil√≠brio emocional e mental</li>
              <li>Prevenir problemas de sa√∫de mais graves no futuro</li>
              <li>Economizar milhares em tratamentos paliativos ineficazes</li>
              <li>Viver com mais qualidade, presen√ßa e bem-estar</li>
            </ul>
          </div>

          <p>E a melhor parte? <strong>Voc√™ n√£o precisa fazer isso sozinho(a).</strong></p>
        </div>

        <!-- 5. CREDIBILIDADE: Autoridade e Prova Social -->
        <div class="section" style="background: #f9fafb;">
          <h2>üë®‚Äç‚öïÔ∏è Apresentando: Mestre Ye e o M√©todo Sa√∫de Vital√≠cia</h2>

          <p>O Mestre Ye √© um dos maiores especialistas em Medicina Tradicional Chinesa e Qi Gong terap√™utico do Brasil.</p>

          <p>Com mais de 20 anos de experi√™ncia, ele j√° transformou a vida de <strong>milhares de pessoas</strong> que, assim como voc√™, sofriam com sintomas cr√¥nicos e desequil√≠brios energ√©ticos.</p>

          <div class="social-proof">
            <p style="color: #4b5563; margin-bottom: 12px;">"Depois de anos tentando tratamentos convencionais sem resultado, encontrei o Qi Gong com Mestre Ye. Em 3 meses, minha enxaqueca cr√¥nica desapareceu. Foi transformador!"</p>
            <p style="font-size: 14px; color: #6b7280; margin: 0; text-align: right;">‚Äî Maria Silva, 42 anos</p>
          </div>

          <div class="social-proof">
            <p style="color: #4b5563; margin-bottom: 12px;">"Eu estava c√©tico no in√≠cio, mas os resultados falam por si. Minha ansiedade diminuiu drasticamente e finalmente consigo dormir bem. Recomendo de olhos fechados!"</p>
            <p style="font-size: 14px; color: #6b7280; margin: 0; text-align: right;">‚Äî Jo√£o Santos, 38 anos</p>
          </div>
        </div>

        <!-- 6. OFERTA: Apresentar a Solu√ß√£o Concreta -->
        <div class="section" style="background: white;">
          <h2>üéÅ Evento Especial: Black November da Sa√∫de Vital√≠cia</h2>

          <p>Normalmente, uma consulta personalizada com diagn√≥stico MTC completo custa mais de R$ 500.</p>

          <p>Mas durante o <strong>Black November da Sa√∫de Vital√≠cia</strong>, o Mestre Ye vai revelar:</p>

          <ul class="benefit-list">
            <li>O m√©todo completo para desbloquear seu ${elementoNome}</li>
            <li>Pr√°ticas de Qi Gong espec√≠ficas para seu diagn√≥stico</li>
            <li>Como implementar isso na sua rotina (mesmo se voc√™ tem apenas 15 minutos por dia)</li>
            <li>Acesso ao programa completo de transforma√ß√£o</li>
            <li>B√¥nus exclusivos para quem participar do evento</li>
          </ul>

          <div class="urgency-box">
            <p style="margin: 0;"><strong>‚è∞ Vagas Limitadas!</strong></p>
            <p style="margin-top: 8px; margin-bottom: 0; font-size: 16px;">Apenas 100 pessoas ter√£o acesso a essa oferta especial.</p>
          </div>
        </div>

        <!-- 7. CTA: Chamada Para A√ß√£o Clara e Direta -->
        <div class="section section-cta">
          <h1 style="color: white; margin-bottom: 24px;">Est√° Pronto Para Transformar Sua Sa√∫de, ${primeiroNome}?</h1>

          <p style="color: rgba(255,255,255,0.95); font-size: 20px; margin-bottom: 32px;">Voc√™ tem duas op√ß√µes:</p>

          <p style="color: rgba(255,255,255,0.95); font-size: 18px; margin-bottom: 8px;"><strong>Op√ß√£o 1:</strong> Ignorar isso e continuar gastando dinheiro em solu√ß√µes que n√£o funcionam...</p>

          <p style="color: rgba(255,255,255,0.95); font-size: 18px; margin-bottom: 32px;"><strong>Op√ß√£o 2:</strong> Dar o pr√≥ximo passo e descobrir como o Mestre Ye pode te ajudar a resolver isso de uma vez por todas.</p>

          <button class="cta-button" onclick="window.location.href='https://saudevitalicia.com.br/black-november'">
            üî• QUERO PARTICIPAR DO EVENTO
          </button>

          <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin-top: 16px;">Clique no bot√£o acima para garantir sua vaga</p>

          <button class="cta-button cta-secondary" onclick="window.location.href='mailto:contato@saudevitalicia.com.br?subject=D√∫vidas sobre meu diagn√≥stico - ${primeiroNome}'">
            üí¨ Tenho D√∫vidas - Quero Falar com um Especialista
          </button>
        </div>

        <!-- 8. RISK REVERSAL: Garantia e Redu√ß√£o de Risco -->
        <div class="section" style="background: #f9fafb;">
          <h2 style="text-align: center;">üõ°Ô∏è Garantia de 30 Dias ou Seu Dinheiro de Volta</h2>

          <p style="text-align: center;">Experimente o m√©todo por 30 dias. Se voc√™ n√£o sentir melhorias reais na sua sa√∫de e bem-estar, devolvemos 100% do seu investimento. Sem perguntas, sem complica√ß√£o.</p>

          <p style="text-align: center; color: #6b7280; font-size: 16px; margin-top: 24px;">Voc√™ n√£o tem nada a perder. Apenas sa√∫de a ganhar.</p>
        </div>

        <!-- 9. FINAL URGENCY: √öltimo Empurr√£o -->
        <div class="section" style="background: white; text-align: center;">
          <h2>‚è∞ N√£o Deixe Para Depois, ${primeiroNome}</h2>

          <p>Seu corpo j√° esperou tempo demais.</p>

          <p>Cada dia que passa sem tomar uma atitude √© mais um dia vivendo com sintomas desnecess√°rios.</p>

          <p style="font-size: 20px; font-weight: 600; color: #667eea; margin-top: 32px;">A transforma√ß√£o come√ßa com UMA decis√£o.</p>

          <p style="font-size: 20px; font-weight: 600; color: #667eea;">Essa decis√£o √© AGORA.</p>

          <button class="cta-button" style="margin-top: 32px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;" onclick="window.location.href='https://saudevitalicia.com.br/black-november'">
            ‚ú® SIM, QUERO TRANSFORMAR MINHA SA√öDE AGORA
          </button>
        </div>
      `;

      document.getElementById('loading').style.display = 'none';
      document.getElementById('content').style.display = 'block';
      document.getElementById('content').innerHTML = html;
    }

    // Iniciar
    carregarResultados();
  </script>
</body>
</html>
